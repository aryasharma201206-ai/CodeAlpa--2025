#include <stdio.h>
#include <stdlib.h>

struct student {
    int roll;
    char name[50];
    float marks;
};

int main() {
    FILE *fp, *temp;
    struct student s;
    int ch, roll, found;

    do {
        printf("\n1.Add");
        printf("\n2.Display");
        printf("\n3.Search");
        printf("\n4.Delete");
        printf("\n5.Update");
        
        printf("\nEnter choice: ");
        scanf("%d", &ch);

        switch(ch) {

        case 1:  
            fp = fopen("stud.dat", "ab");
            scanf("%d %s %f", &s.roll, s.name, &s.marks);
            fwrite(&s, sizeof(s), 1, fp);
            fclose(fp);
            break;

        case 2:   
            fp = fopen("stud.dat", "rb");
            while(fread(&s, sizeof(s), 1, fp))
                printf("%d %s %.2f\n", s.roll, s.name, s.marks);
            fclose(fp);
            break;

        case 3:   
            found = 0;
            fp = fopen("stud.dat", "rb");
            scanf("%d", &roll);
            while(fread(&s, sizeof(s), 1, fp)) {
                if(s.roll == roll) {
                    printf("%d %s %.2f\n", s.roll, s.name, s.marks);
                    found = 1;
                }
            }
            if(!found)
                printf("Not Found\n");
            fclose(fp);
            break;

        case 4:  
            fp = fopen("stud.dat", "rb");
            temp = fopen("temp.dat", "wb");
            scanf("%d", &roll);
            found = 0;

            while(fread(&s, sizeof(s), 1, fp)) {
                if(s.roll != roll)
                    fwrite(&s, sizeof(s), 1, temp);
                else
                    found = 1;
            }

            fclose(fp);
            fclose(temp);
            remove("stud.dat");
            rename("temp.dat", "stud.dat");

            if(found) printf("Deleted\n");
            else printf("Not Found\n");
            break;

        case 5:  
            fp = fopen("stud.dat", "rb");
            temp = fopen("temp.dat", "wb");
            scanf("%d", &roll);
            found = 0;

            while(fread(&s, sizeof(s), 1, fp)) {
                if(s.roll == roll) {
                    scanf("%s %f", s.name, &s.marks);
                    found = 1;
                }
                fwrite(&s, sizeof(s), 1, temp);
            }

            fclose(fp);
            fclose(temp);
            remove("stud.dat");
            rename("temp.dat", "stud.dat");

            if(found) printf("Updated\n");
            else printf("Not Found\n");
            break;

      

        default:
            printf("Invalid\n");
        }

    } while(1);

    return 0;
}
